<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DevReady • Screen 2 — Match to Role</title>
  <link rel="stylesheet" href="../assets/styles.css"/>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="brand">
        <img src="../assets/logo.svg" alt="DevReady" style="width:42px;height:42px"/>
        <div class="title">
          <span>DEV</span>
          <span>READY</span>
          <span class="sub">Vetting • UX mock</span>
        </div>
      </div>

      <div class="userbox">
        <div style="font-size:12px;opacity:.9">Welcome back,</div>
        <div class="name">Darrin Joncas</div>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <span class="badge">Technology domain</span>
          <span class="badge">UI/UX only</span>
        </div>
      </div>

      <nav class="nav">
        <a href="find-candidate.html" class=""><span class="dot"></span>Vetting</a><a href="profile-preview.html" class=""><span class="dot"></span>Profiles</a><a href="match-role.html" class="active"><span class="dot"></span>Job Descriptions</a><a href="status-tracker.html" class=""><span class="dot"></span>Results</a>
        <div class="hint">
          Mock navigation for the end-to-end flow. No backend calls — all buttons are visual placeholders.
        </div>
      </nav>

      <div class="footer">
        DevReady • www.devready.io<br/>
        Green theme + clean cards (no icons)
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div>
          <div class="page-title">Screen 2 — Match to Role</div>
          <div class="breadcrumb">Vetting Process • Matching</div>
        </div>
        <div class="search">
          <input class="input" placeholder="Search for profiles (name / email)"/>
          <button class="btn secondary" type="button" onclick="alert('Mock only')">Search</button>
        </div>
      </div>

      <div class="card" style="margin-bottom:18px">
        <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:center">
          <div>
            <div style="font-weight:900;margin-bottom:6px">Process Flow</div>
            <div style="color:var(--muted);font-size:13px">Click through the 7 screens in order. Each page stands alone but is linked for UX review.</div>
          </div>
          <div class="flow"><a class="step " href="find-candidate.html">1 · Find candidate</a><a class="step on" href="match-role.html">2 · Match to role</a><a class="step " href="candidate-chat.html">3 · Candidate chat</a><a class="step " href="profile-preview.html">4 · Profile build</a><a class="step " href="client-comm.html">5 · Client comms</a><a class="step " href="schedule-interview.html">6 · Schedule interview</a><a class="step " href="status-tracker.html">7 · Track & export</a></div>
        </div>
      </div>

      <div class="grid">
        <section class="card">
          
<h2>Match candidate(s) to a role & job description</h2>
<p>Paste or upload a job description, normalize it, then rank stored profiles and select the top 10 for deeper vetting.</p>

<div class="split">
  <div class="field">
    <label>Job description input</label>
    <textarea placeholder="Paste job description here..."></textarea>
    <div class="row-actions">
      <button class="btn" type="button" onclick="alert('Mock: normalize JD')">Normalize &amp; Save</button>
      <button class="btn secondary" type="button" onclick="alert('Mock: view JD')">View JD (HTML)</button>
      <button class="btn secondary" type="button" onclick="alert('Mock: download JD')">Download (DOCX)</button>
    </div>
    <small>Tip: keep requirements crisp — must-have vs nice-to-have.</small>
  </div>

  <div>
    <div class="field">
      <label>JD metadata</label>
      <div class="split">
        <div class="field"><label>Company</label><input value="DevReady / Client"/></div>
        <div class="field"><label>Job title</label><input value="Senior Full-Stack Engineer"/></div>
      </div>
    </div>

    <div class="field" style="margin-top:10px">
      <label>Rank stored profiles</label>
      <div class="split">
        <div class="field">
          <label>Select saved JD</label>
          <select id="jdSelect">
            <option selected disabled hidden>Select Description</option>
            <option value="JDD-20260129003241729">Senior Full-Stack Engineer (v2)</option>
            <option value="JDD-20260129002613803">VR App Developer (Oculus Quest 2)</option>
            <option value="JDD-20260129001812443">Data Platform Architect (Azure)</option>
          </select>
        </div>
        <div class="field">
          <label>Return</label>
          <select id="topK">
            <option value="10">Top 10</option>
            <option value="20">Top 20</option>
            <option value="30">Top 30</option>
          </select>
        </div>
      </div>
      <div class="row-actions">
        <button class="btn" type="button" id="btnRank">Rank Profiles</button>
        <button class="btn secondary" type="button" onclick="alert('Mock: show rationale')">Show rationale</button>
      </div>
    </div>
  </div>
</div>

<h2 style="margin-top:18px" id="rankHeader">Ranked results (Top 10)</h2>
<div class="muted" style="margin-top:8px" id="matchStatus">No match run yet.</div>
<table class="table" id="resultsTable">
  <thead><tr><th>#</th><th>Candidate</th><th>Email</th><th>Score</th><th>Top matches</th><th></th></tr></thead>
  <tbody>
    <tr><td>1</td><td><strong>Giovanni S</strong></td><td>giovanni@email.com</td><td><strong>92</strong></td><td>Backend • APIs • Identity</td><td><a class="btn secondary" href="candidate-chat.html" style="padding:8px 12px">Open</a></td></tr>
    <tr><td>2</td><td><strong>Maria T</strong></td><td>maria@email.com</td><td><strong>88</strong></td><td>Angular • SQL • CI/CD</td><td><a class="btn secondary" href="candidate-chat.html" style="padding:8px 12px">Open</a></td></tr>
    <tr><td>3</td><td><strong>John N Farmer</strong></td><td>john.farmer@email.com</td><td><strong>83</strong></td><td>Unity • C# • VR</td><td><a class="btn secondary" href="candidate-chat.html" style="padding:8px 12px">Open</a></td></tr>
    <tr><td>4</td><td><strong>Kevin P</strong></td><td>kevin@email.com</td><td><strong>81</strong></td><td>React • Node • AWS</td><td><a class="btn secondary" href="candidate-chat.html" style="padding:8px 12px">Open</a></td></tr>
  </tbody>
</table>

<div class="notice" style="margin-top:12px">
  Next: open a candidate and start the guided AI chat to produce private + public profile.
</div>

        </section>
        <aside class="card">
          
      <h2>What happens on this screen</h2>
      <p>UX-only guidance for this screen.</p>
      <ul style="margin:0 0 14px 18px;color:var(--muted);line-height:1.4"><li>Save / normalize a JD (structured requirements).</li><li>Rank stored candidates and pick the Top 10.</li><li>Outcome: open a candidate into the guided chat.</li></ul>
      <div class="row-actions"><a class="btn " href="candidate-chat.html" style="text-decoration:none;display:inline-block">Next: Candidate chat →</a><a class="btn secondary" href="find-candidate.html" style="text-decoration:none;display:inline-block">Back: Find candidate</a></div>
      <div class="notice" style="margin-top:14px">All actions here are mocked. The goal is to validate layout, flow, and labels.</div>
    
        </aside>
      </div>
    </main>
  </div>

  <script src="JS/apiScripts.js"></script>
  <script>
    // tiny UX sugar (mock only)
    document.querySelectorAll('a.step').forEach(a=>a.addEventListener('click', ()=>{}));

    // Normalize match score to 0-100 for correct ranking + display
    function normalizeScore(raw) {
      const n = Number(raw);
      if (!isFinite(n)) return 0;

      // If backend returns 0..1, scale up
      if (n > 0 && n <= 1) return n * 100;

      // If backend returns 0..10, scale up
      if (n > 1 && n <= 10) return n * 10;

      // Otherwise assume already 0..100
      return n;
    }

    // Rank profiles based on job description
    async function rank() {
      const jd_id = document.getElementById("jdSelect").value;
      // Currently unused below
      // selectedJdId = jd_id;
      // setText("activeJdLabel", jd_id ? ("Active JD: " + jd_id) : "Active JD: (none)");

      const top_k = parseInt(document.getElementById("topK").value, 10) || 10;
      if (!jd_id || jd_id.length < 1) return alert("Select a job description to rank against.");
      // document.getElementById("matchStatus").textContent = "Ranking...";

      document.getElementById("rankHeader").textContent = `Ranked Results (Top ${top_k})`;

      const fd = new FormData();
      fd.append("domain", "technology");
      fd.append("jd_id", jd_id);
      fd.append("top_k", String(top_k));

      try {
        const j = await api("/api/match/run", { method: "POST", body: fd });

        // Normalize + re-sort defensively (in case backend returns non-100 scale)
        latestRank = (j.results || []).map(r => ({
          ...r,
          _score100: normalizeScore(r.score)
        }));
        latestRank.sort((a, b) => (b._score100 || 0) - (a._score100 || 0));

        const tbody = document.querySelector("#resultsTable tbody");
        tbody.innerHTML = "";

        latestRank.forEach((r, i) => {
          const tr = document.createElement("tr");
          tr.style.cursor = "pointer";
          tr.innerHTML = `<td>${i + 1}</td><td>${r.name || ""}</td><td>${r.email || ""}</td><td>${Math.round(r._score100 || 0)}</td><td>${(r.top_matches || []).slice(0, 6).join(", ")}</td>`;
          tr.addEventListener("click", () => selectRow(r));
          tbody.appendChild(tr);
        });

        document.getElementById("matchStatus").textContent = `Returned ${latestRank.length} results (Top ${top_k}). Click a row to select.`;
        // setDisabled("btnReadyIT", true);
        // setDisabled("btnReadyIT2", true);
        // setDisabled("btnReportHtml", true);
        // setDisabled("btnReportDocx", true);
        // setText("explainBox", "Select a result row after ranking.");
        // clearRec();
      } catch (e) {
        document.getElementById("matchStatus").textContent = `Rank failed: ${e.message}`;
      }
    }

    document.getElementById("btnRank").addEventListener("click", rank);
  </script>
</body>
</html>